<!doctype html>
<html lang="en">
    <link rel="icon" type="image/x-icon" href="/public/images/favicon.png" />
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Admin Panel | Rojolet</title>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Titan+One&family=Nunito+Sans:wght@400;700&display=swap"
            rel="stylesheet"
        />
        <style>
            body {
                font-family: "Nunito Sans", sans-serif;
                margin: 0;
                padding: 0;
                background-image: url("images/checkers.png");
                background-size: cover;
                background-position: center;
                height: 100vh;
                justify-content: center;
                align-items: center;
            }

            .container {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 20px;
                max-width: 750px;
                height: 300px;
                width: 100%;
                background-color: #a30000;
                border-radius: 20px;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                color: #fff;
                text-align: center;
                margin-left: 800px;
                margin-top: 100px;
                box-shadow: inset 0 -10px rgba(0, 0, 0, 0.2);
            }

            h1 {
                font-family: "Titan One", sans-serif;
                color: #fff;
                font-size: 28px;
                text-align: center;
            }

            .username-input {
                width: 460px;
                padding: 10px;
                margin: 10px 0;
                border-radius: 5px;
                border: 1px solid #ccc;
            }

            .search-button {
                color: #fff;
                background-color: #8b0202;
                border: none;
                height: 45px;
                width: 100px;
                font-family: "Titan One", sans-serif;
                font-size: 17px;
                border-radius: 7px;
                cursor: pointer;
                margin-top: -800px;
            }

            #userDetails {
                margin-top: 20px;
                padding: 10px;
                background-color: #f9f9f9;
                border-radius: 5px;
                border: 1px solid #ddd;
            }

            #userForm div {
                margin: 10px 0;
            }

            #userForm label {
                display: block;
                margin-bottom: 5px;
                font-weight: bold;
                color: #333;
            }

            #userForm input {
                padding: 8px;
                width: 100%;
                border-radius: 5px;
                border: 1px solid #ccc;
                box-sizing: border-box;
            }

            .update-button {
                color: #fff;
                background-color: #007bff;
                border: none;
                padding: 10px 20px;
                font-family: "Nunito Sans", sans-serif;
                font-size: 16px;
                border-radius: 5px;
                cursor: pointer;
                margin-top: 10px;
            }
            .nav-button {
        background-color: #d40000;
        display: flex;
        justify-content: space-around;
        margin-top: 20px;
        width: 100%;
        font-family: "Titan One", sans-serif;
    }
    .nav-button a {
        text-decoration: none;
        color: #fff;
        background-color: #c20000;
        padding: 10px 40px;
        border-radius: 5px;
        font-family: "Nunito Sans", sans-serif;
        font-weight: 700;
        font-size: 16px;
        transition: background-color 0.3s;
    }
    .nav-button a:hover {
        background-color: #a30000;
    }






    .nav-bar {
        padding-right: 15px;
        padding-left: 15px;
        background-color: red;
    }
    .navdiv {
        display: flex;
        align-items: center;
        background-color: #8B0000;
        border-bottom: #6B0000 8px solid;
        height: 100px;
    }
    .logo a {
        margin-left: 15px;
        font-size: 35px;
        color: #fff;
        font-family: "Titan One", sans-serif;
        text-decoration: none;
    }
    button {
        background-color: #9d0000;
        margin-left: 10px;
        border-radius: 10px;
        border-color: #fff;
        padding: 10px;
        width: 90px;
        text-decoration: none;
    }
    button a {
        color: white;
        font-family: "Titan One", sans-serif;
        font-size: 15px;
        text-decoration: none;
    }
        </style>
    </head>
    <body>
        <nav class="navbar">
            <div class="navdiv">
                <div class="logo"><a href="index.html">Rojolet</a></div>
                <ul>
                    <button><a href="stats.html">Stats</a></button>
                    <button><a href="chat.html">Chat</a></button>
                    <button><a href="market.html">Market</a></button>
                    <button><a href="blooks.html">Blooks</a></button>
                    <button><a href="guilds.html">Clans</a></button>
                    <button><a href="#">Panel</a></button>
                </ul>
            </div>
        </nav>

        <div class="container">
            <h1>Admin Panel</h1>
            <div>
                <input
                    class="username-input"
                    type="text"
                    id="username"
                    placeholder="Search User"
                />
                <button class="search-button" onclick="searchUser()">
                    Search
                </button>
            </div>
            <div id="userDetails" style="display: none">
                <h2>User Details</h2>
                <form id="userForm"></form>
                <button class="update-button" onclick="updateUser()">
                    Update User
                </button>
            </div>
        </div>

        <script>
            const firebaseConfig = {
                apiKey: "AIzaSyCOIKlP9YhtX9xa5aoggmsrWwavlW-XuzI",
                authDomain: "cosmik-7c124.firebaseapp.com",
                databaseURL: "https://cosmik-7c124-default-rtdb.firebaseio.com",
                projectId: "cosmik-7c124",
                storageBucket: "cosmik-7c124.appspot.com",
                messagingSenderId: "412506429662",
                appId: "1:412506429662:web:9ca3e17199297df7384a4f",
                measurementId: "G-R7K0LTHCK3",
            };

            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();

            let currentUserDocId = null;

            const cookieValue = document.cookie
                .split("; ")
                .find((row) => row.startsWith("uid="));
            const uid = cookieValue ? cookieValue.split("=")[1] : null;

            if (!uid) {
                alert("UID not found in cookies.");
                window.location.href = "index.html";
            }

            function checkUserRole() {
                db.collection("users")
                    .doc(uid)
                    .get()
                    .then((doc) => {
                        if (!doc.exists) {
                            alert("No user found.");
                            window.location.href = "index.html";
                            return;
                        }

                        const userRole = doc.data().roles;
                        if (userRole !== "Co-owner" && userRole !== "Owner") {
                            alert(
                                "Access Denied: You do not have the required permissions.",
                            );
                            window.location.href = "index.html";
                        }
                    })
                    .catch((error) => {
                        console.error("Error checking user role: ", error);
                    });
            }

            function searchUser() {
                const username = document
                    .getElementById("username")
                    .value.trim();
                if (!username) {
                    alert("Please enter a username.");
                    return;
                }

                db.collection("users")
                    .where("username", "==", username)
                    .get()
                    .then((querySnapshot) => {
                        if (querySnapshot.empty) {
                            alert("No user found with that username.");
                            return;
                        }

                        querySnapshot.forEach((doc) => {
                            currentUserDocId = doc.id;
                            const userData = doc.data();
                            displayUserFields(userData);
                        });
                    })
                    .catch((error) => {
                        console.error("Error searching for user: ", error);
                    });
            }

            function displayUserFields(userData) {
                const form = document.getElementById("userForm");
                form.innerHTML = "";

                for (const key in userData) {
                    if (userData.hasOwnProperty(key)) {
                        const fieldHTML = `<div>
                            <label for="${key}">${key}</label>
                            <input type="text" id="${key}" value="${userData[key]}" />
                        </div>`;
                        form.innerHTML += fieldHTML;
                    }
                }

                document.getElementById("userDetails").style.display = "block";
            }

            function updateUser() {
                if (!currentUserDocId) {
                    alert("No user selected for update.");
                    return;
                }

                const updatedData = {};
                const form = document.getElementById("userForm");
                const inputs = form.querySelectorAll("input");

                inputs.forEach((input) => {
                    const key = input.id;
                    const value = input.value;
                    updatedData[key] = value;
                });

                db.collection("users")
                    .doc(currentUserDocId)
                    .update(updatedData)
                    .then(() => {
                        alert("User updated successfully!");
                    })
                    .catch((error) => {
                        console.error("Error updating user: ", error);
                    });
            }

            checkUserRole();
        </script>
    </body>
</html>
